Расчёт автоматических уровней для торговли:

>>* локальные fibo retracement/extensions рассчитываются автоматически по экстремумам дня. Они становятся рабочими и слабыми уровнями, как только любые две соседние зоны fibo окажутся достаточно широкими, чтобы позволить торговлю от их противоположных краёв. Но для этого нужно научиться определять направление дневного тренда.

>>Все уровни - как расчитанные автоматически, так и введённые вручную, должны отображаться на виджете уровней.

Расчёт параметров сделки:

>>* определение в реальном времени цены, от которой возможна торговля в заданном направлении. Эта цена называется опорной точкой торговли. Это либо:
 >>- ближайший в направлении торговли уровень, который цена готовится пробить.
 >>- текущая цена, если она уже прошла ближайший уровень, но находится далеко от следующего.

>>* определение в реальном времени цели торговли. Это ближайший уровень в направлении торговли, для которого, используя опорную точку, возможно разместить защитный стоп-лосс за ближайший уровень (либо границу консолидации/коррекции), расположенный за опорной точкой. При этом необходимо расчитывать реалистический запас хода цены до цели торговли на основании ATR дня и ATR часа. Необходимо отображать имеющийся запас хода для установленной цели торговли на виджете уровней.

>>* должна быть возможность выбрать (или снять) цель торговли вручную на виджете уровней.
  >>- цель торговли, выбранная вручную должна быть снята после отправки ордера на вход в сделку.

Программа должна заблаговременно сигнализировать о возможности входа в сделку для следующих сценариев:

>>* разворот цены от локальных экстремумов, если они находятся вблизи уровней. Для чего необходимо:
 >>- определять локальные экстремумы.
 >>- определять наличие разворота.
 >>- возможность разместить защитный стоп-лосс за ближайшим уровнем в направлении противоположном направлению торговли.
 >>- иметь цель торговли с положительным запасом хода до неё.

>>* выход цены из консолидации/коррекции:
   >>- нужно научиться определять коррекции и консолидации и их границы.
   >>- возможность поставить стоп-лосс либо за границу, противоположную направлению торговли, либо за ближайший сильный уровень позади точки входа.
   >>- иметь цель торговли с положительным запасом хода до неё.

После входа в сделку, программа должна её отслеживать до полного закрытия позиции по сделке:
   >>- необходимо получать от API брокера сведения об открытых позициях и выбрать последнюю открытую
   >>- необходимо получать от API брокера сведения об активных ордерах и выбрать относящиеся к текущей сделке
   >>- для текущей сделки записывать все изменения (объёмы, параметры ордеров) в базу данных с сохранением истории сделки
   >>- после закрытия программы и нового соединения с API брокера, программа должна продолжить отслеживание открытых позиций.

Программа должна показывать торговую ситуацию в реальном времени на виджете торговли:

   >>- текущая лучшая цена сделки по направлению торговли
   >>- оставшийся запас хода в обоих направлениях (long/short) по ATR дня
   >>- оставшийся запас хода в обоих направлениях по ATR часа (если это не первый час торговой сессии)
   >>- расстояние до ближайшего экстремума дня по цене
   >>- расстояние до ближайшего экстремума дня по времени
   >>- расстояние до ближайшего уровня в обоих направлениях
   >>- нахождение в коррекции или консолидации
   >>- возможный вход в разворот
   >>- нахождение в локальном/дневном экстремуме
   >>- позицию потенциального стоп-лосса
   >>- позицию потенциального безубытка
   >>- потенциальный заработок
   >>- текущие прибыль/убыток дня
   >>- прошедшее время сессии
   >>- оставшееся время сессии

Программа должна показывать все открытые позиции на всех активах на виджете позиций:
   >>- тикер позиции
   >>- объём в количестве акций
   >>- текущий объем в денежном выражении
   >>- текущую бумажную прибыль/убыток
   >>- текущую цену в процентах от take-profit и от stop-loss
   >>- перенести Drop All на текущую позицию


Доработки:

>>* нужно увеличить размер лимита в стоп-лимите хотя бы до полутора-двух спредов. А то он постоянно не срабатывает.
>>* стоп-лосс всегда должен находиться за ближайшим уровнем или за противоположной границей консолидации или коррекции. Кроме этого он должен быть ближе к уровню, если уровень сильный и дальше, если уровень слабый. Для слабых и не подтверждённых уровней стоп-лосс должен находиться на максимально возможном расстоянии. На основании размера стоп-лосса, необходимо расчитывать объём сделки так, чтобы потери при фиксации убытков не превышали заданного риска на сделку.
>>* нужна возможность расчитывать силу уровней, а возможно, и создавать новые уровни исходя из касаний цены уровня high или low свечей на рабочем таймфрейме. Для этого необходимо создать эвристический алгоритм оценки силы уровней.
>>* автоматически заменять введённую запятую на десятичную точку в поле ввода числа.
* программа должна иметь всплывающее окно калькулятора, которое открывается по кнопке на виджете торговли.
  - окно калькулятора должно включать необходимые параметры для расчёта сделки и результаты расчёта
  - виджет торговли должен включать в себя кнопки для входа в позицию и аварийного закрытия позиций, а также выбор тикера для торговли.
  - при переключении тикера, введенные уровни для данного тикера восстанавливаются из базы данных, данные основанные на статистике перерасчитываются автоматически.

Необходимые условия:

>>* Для всего этого нужно записывать в базу данных историю текущей торговой сессии на рабочем таймфрейме. То есть рабочий таймфрейм становится параметром программы. Торговая сессия из рабочего таймфрейма должна автоматически переводиться в старшие таймфреймы H1/D1 и также записываться в базу данных.
  - для чего необходимо создать соответствующую таблицу в базе данных
>>* Для текущего актива необходимо иметь возможность ввести историю за предыдущие дня в базу данных из CSV-файла. Для чего необходима кнопка и форма загрузки файла.
>>* Необходима процедура расчёта ATR дня и ATR часа, основанная на имеющихся статистических данных.
>>* Необходимо разработать макет торгового виджета, виджета уровней, виджета позиций и окно калькулятора

