<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">
    <changeSet id="00000000000001" author="oleg">
        <addColumn tableName="ticker">
            <column name="currency_id" type="bigint">
                <constraints nullable="false" />
            </column>
        </addColumn>
        <dropColumn tableName="trade_log">
            <column name="local_date" type="datetime" />
        </dropColumn>
        <createTable tableName="deposit">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="currency_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="broker_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="utc_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="sum" type="number">
                <constraints nullable="false"/>
            </column>
            <column name="note" type="varchar(128)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint
                baseTableName="deposit"
                baseColumnNames="currency_id"
                constraintName="deposit_currency_fk"
                referencedTableName="currency"
                referencedColumnNames="id" />
        <addForeignKeyConstraint
                baseTableName="ticker"
                baseColumnNames="currency_id"
                constraintName="ticker_currency_fk"
                referencedTableName="currency"
                referencedColumnNames="id" />
        <addForeignKeyConstraint
                baseTableName="trade_log"
                baseColumnNames="broker_id"
                constraintName="trade_log_broker_fk"
                referencedTableName="broker"
                referencedColumnNames="id" />
        <addForeignKeyConstraint
                baseTableName="trade_log"
                baseColumnNames="market_id"
                constraintName="trade_log_market_fk"
                referencedTableName="market"
                referencedColumnNames="id" />
        <addForeignKeyConstraint
                baseTableName="trade_log"
                baseColumnNames="ticker_id"
                constraintName="trade_log_ticker_fk"
                referencedTableName="ticker"
                referencedColumnNames="id" />
        <addForeignKeyConstraint
                baseTableName="trade_log"
                baseColumnNames="currency_id"
                constraintName="trade_log_currency_fk"
                referencedTableName="currency"
                referencedColumnNames="id" />
    </changeSet>
</databaseChangeLog>
